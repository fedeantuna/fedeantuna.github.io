<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><title>Deploy NEXT.JS App to GitHub Pages</title><base target="_blank"/><meta name="next-head-count" content="5"/><link rel="preload" href="/_next/static/css/89dd4a6baed5448f7af8.css" as="style"/><link rel="stylesheet" href="/_next/static/css/89dd4a6baed5448f7af8.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.4b81eedf2fcdb09bf521.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.4825e5e9d187cd4ab7dd.js" as="script"/><link rel="preload" href="/_next/static/chunks/main-86c34d104cdfe5877fdd.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-c5dfe0a27de1f670d0d4.js" as="script"/><link rel="preload" href="/_next/static/chunks/63c1bd8fe8e29f7d1674476eb835b66f2691ac72.17a2de98099826b1f148.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/article/%5Bid%5D-a1e1aaf80fe42cc5b9f0.js" as="script"/></head><body><div id="__next"><div class="container sm:m-auto"><header><div class="flex space-x-5 justify-end mt-5 mr-2 lg:mr-0"><a class="w-16 h-16" href="/"><img class="m-0 rounded-full border border-gray-100 shadow-sm" src="/images/profile.png" alt="Federico Antuña"/></a><div class="self-center"><h2 class="m-0"><a href="/">Federico Antuña</a></h2><h2 class="m-0 text-sm">Software Developer</h2><div class="flex justify-center space-x-1 mt-1"><div><a href="https://www.linkedin.com/in/federicoantuna/" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="w-4 h-4 fill-current text-gray-400 hover:text-blue-500"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></div><div><a href="https://github.com/fedeantuna" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="w-4 h-4 fill-current text-gray-400 hover:text-black"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM277.3 415.7c-8.4 1.5-11.5-3.7-11.5-8 0-5.4.2-33 .2-55.3 0-15.6-5.2-25.5-11.3-30.7 37-4.1 76-9.2 76-73.1 0-18.2-6.5-27.3-17.1-39 1.7-4.3 7.4-22-1.7-45-13.9-4.3-45.7 17.9-45.7 17.9-13.2-3.7-27.5-5.6-41.6-5.6-14.1 0-28.4 1.9-41.6 5.6 0 0-31.8-22.2-45.7-17.9-9.1 22.9-3.5 40.6-1.7 45-10.6 11.7-15.6 20.8-15.6 39 0 63.6 37.3 69 74.3 73.1-4.8 4.3-9.1 11.7-10.6 22.3-9.5 4.3-33.8 11.7-48.3-13.9-9.1-15.8-25.5-17.1-25.5-17.1-16.2-.2-1.1 10.2-1.1 10.2 10.8 5 18.4 24.2 18.4 24.2 9.7 29.7 56.1 19.7 56.1 19.7 0 13.9.2 36.5.2 40.6 0 4.3-3 9.5-11.5 8-66-22.1-112.2-84.9-112.2-158.3 0-91.8 70.2-161.5 162-161.5S388 165.6 388 257.4c.1 73.4-44.7 136.3-110.7 158.3zm-98.1-61.1c-1.9.4-3.7-.4-3.9-1.7-.2-1.5 1.1-2.8 3-3.2 1.9-.2 3.7.6 3.9 1.9.3 1.3-1 2.6-3 3zm-9.5-.9c0 1.3-1.5 2.4-3.5 2.4-2.2.2-3.7-.9-3.7-2.4 0-1.3 1.5-2.4 3.5-2.4 1.9-.2 3.7.9 3.7 2.4zm-13.7-1.1c-.4 1.3-2.4 1.9-4.1 1.3-1.9-.4-3.2-1.9-2.8-3.2.4-1.3 2.4-1.9 4.1-1.5 2 .6 3.3 2.1 2.8 3.4zm-12.3-5.4c-.9 1.1-2.8.9-4.3-.6-1.5-1.3-1.9-3.2-.9-4.1.9-1.1 2.8-.9 4.3.6 1.3 1.3 1.8 3.3.9 4.1zm-9.1-9.1c-.9.6-2.6 0-3.7-1.5s-1.1-3.2 0-3.9c1.1-.9 2.8-.2 3.7 1.3 1.1 1.5 1.1 3.3 0 4.1zm-6.5-9.7c-.9.9-2.4.4-3.5-.6-1.1-1.3-1.3-2.8-.4-3.5.9-.9 2.4-.4 3.5.6 1.1 1.3 1.3 2.8.4 3.5zm-6.7-7.4c-.4.9-1.7 1.1-2.8.4-1.3-.6-1.9-1.7-1.5-2.6.4-.6 1.5-.9 2.8-.4 1.3.7 1.9 1.8 1.5 2.6z"></path></svg></a></div></div></div></div></header><main class="mr-3 ml-3 lg:mr-0 lg:ml-0"><article><h1 class="text-center text-2xl mt-5">Deploy NEXT.JS App to GitHub Pages</h1><div class="text-center text-sm"><time dateTime="2021-04-29">April 29, 2021</time></div><div class="mt-2 mb-5"><p>These last couple of days I've been wanting to create a simple and straight forward blog, to just keep the articles that I write and present myself. So I decided to do that using GitHub Pages and a simple NEXT.JS application, very similar to the one shown in the <a href="https://nextjs.org/learn/basics/create-nextjs-app">official tutorial</a>. <strike>It suprised me how little and misleading information I found on how to do that, so I'm writing this.</strike> While making this guide I found a video that explains a similar approach to what I did and it's worth taking a look at it! <a href="https://www.youtube.com/watch?v=yRz8D_oJMWQ">You can check it out here</a>. It would have save me some effort finding this earlier.</p>
<h2>Conditions</h2>
<p>Before we start, there are cases where this is not going to be possible so I want to save you the trouble of going through all of this just to get a disgusting suprise at the end.</p>
<p>We are going to depend on the output of <code>next export</code>, so it is important that the application that you want to deploy is able to use it.</p>
<blockquote>
<ul>
<li>
<p>With <code>next export</code>, we build an HTML version of your app. At export time, we call <code>getStaticProps</code> for each page that exports it, and pass the result to the page's component. It's also possible to use the older <code>getInitialProps</code> API instead of <code>getStaticProps</code>, but it comes with a few caveats:</p>
<ul>
<li><code>getInitialProps</code> cannot be used alongside <code>getStaticProps</code> or <code>getStaticPaths</code> on any given page. If you have dynamic routes, instead of using <code>getStaticPaths</code> you'll need to configure the <code>exportPathMap</code> parameter in your <code>next.config.js</code> file to let the exporter know which HTML files it should output.</li>
<li>When <code>getInitialProps</code> is called during export, the <code>req</code> and <code>res</code> fields of its <code>context</code> parameter will be empty objects, since during export there is no server running.</li>
<li><code>getInitialProps</code> <strong>will be called on every client-side navigation</strong>, if you'd like to only fetch data at build-time, switch to <code>getStaticProps</code>.</li>
<li><code>getInitialProps</code> should fetch from an API and cannot use Node.js-specific libraries or the file system like <code>getStaticProps</code> can.</li>
</ul>
</li>
<li>
<p>It's recommended to use and migrate towards <code>getStaticProps</code> over <code>getInitialProps</code> whenever possible.</p>
</li>
<li>
<p>The <code>fallback: true</code> mode of <code>getStaticPaths</code> is not supported when using <code>next export</code>.</p>
</li>
<li>
<p>API Routes are not supported by this method because they can't be prerendered to HTML.</p>
</li>
<li>
<p><code>getServerSideProps</code> cannot be used within pages because the method requires a server. Consider using <code>getStaticProps</code> instead.</p>
</li>
<li>
<p>Internationalized Routing is not supported as it requires Next.js' server-side routing.</p>
</li>
<li>
<p>The <code>next/image</code> component's default loader is not supported when using <code>next export</code>. However, other loader options will work.</p>
</li>
</ul>
</blockquote>
<p>You can read <a href="https://nextjs.org/docs/advanced-features/static-html-export">here</a> for more information.</p>
<p>I will assume that you already have a NEXT.JS app. In order to test if your app will work, go to the <code>package.json</code> and add an <code>export</code> script to the <code>scripts</code> section. It should look something like this:</p>
<pre><code>...
"scripts": {
    "dev": "next dev",
    "build": "next build",
    "export": "next export",
    "start": "next start"
},
...
</code></pre>
<p>And now if you run <code>npm run build &#x26;&#x26; npm run export</code> without problems, then your app is ready.</p>
<h2>Why?</h2>
<p>Why would we try to do something like this if <em>Vercel</em> let's us publish the app without the need of using <code>next export</code> for free? If it's just a blog, why bother on doing all this to just deploy GitHub Pages? Well, in my case, it was because I wanted to accept <em>Brave Rewards</em> and it turns out that that's against <em>Vercel</em>'s fair use policy (I asked the <em>Vercel</em> team).</p>
<p>And I also like the idea of having my blog under <em>.github.io</em>.</p>
<h2>GitHub Repository</h2>
<p>We can use an existent repository for a project site or we can create one for our user or organization site. You can read <a href="https://pages.github.com/">here</a> for more information. The first one is a bit more complicated, but we will address the issues that might present later.</p>
<p>I will also assume that the source code for the NEXT.JS app is on the root (/) directory of the <code>main</code> branch. If that is not the case for you, you will have to make some changes to the things we do to follow along.</p>
<p>Let's create an orphan branch called <code>gh-pages</code> on our local repository and make sure that the staging area is empty. Then create an empty commit and push the branch to GitHub.</p>
<pre><code>git checkout --orphan gh-pages
git reset
git commit --allow-empty -m "Initial commit"
git push --set-upstream origin gh-pages
</code></pre>
<p>Now we go to the <em>Settings</em> tab of our repository on GitHub, to the <em>Pages</em> section and select the branch <code>gh-pages</code> and the <em>/ (root)</em> directory, then we click <em>Save</em>.</p>
<p>We could just push the result of the <code>export</code> to <code>gh-pages</code> manually every time we want to update the page. That will work, but it's too much work for every change we want to make and it requires a lot of manual intervention, so we also want this to be automated as much as possible.</p>
<h2>GitHub Actions</h2>
<p>Let's create a GitHub Action so every time we push our changes to <code>main</code>, we automatically deploy our app. You can read <a href="https://docs.github.com/en/actions/reference/events-that-trigger-workflows">here</a> if you want to use a different trigger.</p>
<p>We will use the <em>Node.js</em> template, you can find the updated one <a href="https://docs.github.com/en/actions/guides/building-and-testing-nodejs">here</a>. Create a file called <em>gh-pages.deploy.yml</em> (you can actually name it whatever you want) under the <em>.github/workflows</em> directory.</p>
<p>In that file we will modify the <em>Node.js</em> template to suit our needs into something like this.</p>
<pre><code>name: Deploy to GitHub Pages

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [14.x]

    steps:
      - name: Get files
        uses: actions/checkout@v2
      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v2
        with:
          node-version: ${{ matrix.node-version }}
      - name: Install packages
        run: npm ci
      - name: Build project
        run: npm run build
      - name: Export static files
        run: npm run export
      - name: Add .nojekyll file
        run: touch ./out/.nojekyll
      - name: Deploy
        uses: JamesIves/github-pages-deploy-action@4.1.1
        with:
          branch: gh-pages
          folder: out
</code></pre>
<p>This file is a set of instructions for GitHub to run our tasks. Let's review it by parts.</p>
<p>The first <code>name</code> is just to indicate the name of the workflow, you can change it to whatever you want.</p>
<p>The <code>on</code> will specify when this workflow should be run. Here we are saying whenever we push to the main branch. You can modify this as needed by changing the branch name or even the trigger action, maybe you want this to be updated on PRs as well like it is on the template.</p>
<p>Then we have <code>jobs</code>. This section will define the jobs that we want to run on the workflow, here we have just the <code>build</code>. Inside it we also specify the OS in which it will be ran, the Node versions and the steps. Unless you really need to change the OS, leave it on <code>ubuntu-latest</code>, you can read more about that <a href="https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners">here</a>. I selected only the 14.x version of Node because that is what works better for me, but if your project needs a different version, then you can change it.</p>
<p>The steps that we will use are quiet simple. On the first step, the checkout step, we get our code. The second step will setup NodeJS. The third one will install the packages with <em>npm</em>. The fourth one will build our project. The fifth will export the static files for <em>NEXT.JS</em>. The sixth step will create a <em>.nojekyll</em> file inside the directory with the exported files. The last step is extracted from <a href="https://github.com/marketplace/actions/deploy-to-github-pages">here</a>. It will create a branch, <code>gh-pages</code> in our case, with the content of the <em>out</em> directory. You can modify that if you need to. The <code>name</code> tag is optional, but I think it is nicer to look at than just the plain command.</p>
<p>IMPORTANT: keep the indentation of the YAML file, it relies on it (kind of like Python).</p>
<p>You might be wondering what is the empty <em>.nojekyll</em> file that we created. Well, GitHub Pages works with the Jekyll engine (more information <a href="https://jekyllrb.com/docs/">here</a>), so there are some directories that will be skipped automatically. Anything that starts with underscore or dot, won't be accessible. Since we need access to _<em>next</em> directory, then we need to bypass Jekyll and the way to do that is by adding that <em>.nojekyll</em> file.</p>
<p>Now we can push our content to the repository and if we check the <em>Actions</em> tab on GitHub, we will see that our workflow is running. Once it's finished, if we go to the GitHub Pages URL (it will be https://YOUR_USERNAME.github.io or https://YOUR_USERNAME.github.io/YOUR_REPOSITORY) we will see our page. If it's a user site, then that's it! We should be able to navigate everything correctly. If it's a project site you might be seeing some issues with the images and static resources. We will fix that next.</p>
<h2>Fixing the issues</h2>
<p>For project sites these are the problems we will see:</p>
<ul>
<li>Images are not loading</li>
<li>Navigation is not working</li>
</ul>
<p>To put it short, the reason why this is happening is because NEXT.JS expects to be under https://YOUR_USERNAME.github.io/ while we are under https://YOUR_USERNAME.github.io/YOUR_REPOSITORY. You can read more about this <a href="https://nextjs.org/docs/basic-features/static-file-serving">here</a>, <a href="https://nextjs.org/docs/api-reference/next.config.js/cdn-support-with-asset-prefix">here</a> and <a href="https://nextjs.org/docs/api-reference/next.config.js/basepath">here</a>.</p>
<p>To fix this we will make use of environment variables. On the example we can see on the NEXT.JS documentation, on the <em>CDN Supoport with Asset Prefix</em> section, it's using the <em>NODE_ENV</em> variable to check if we are on production. We could use something like that but in our case I prefer using the <em>NEXT_PUBLIC_BASE_PATH</em> variable.</p>
<p>We have to first create a file on the root of our app called <code>next.config.js</code> and put this content inside:</p>
<pre><code>module.exports {
    basePath: process.env.NEXT_PUBLIC_BASE_PATH,
    assetPrefix: process.env.NEXT_PUBLIC_BASE_PATH
}
</code></pre>
<p>Then on the YAML file (the one we named <code>gh-pages.deploy.yml</code> earlier), we have to add that variable and initialize it with our repository name.</p>
<pre><code>...
jobs:
  build:
    runs-on: ubuntu-latest

    env:
      NEXT_PUBLIC_BASE_PATH: /YOUR_REPOSITORY

    strategy:
      matrix:
        node-version: [14.x]
...
</code></pre>
<p>Make sure to replace <em>YOUR_REPOSITORY</em> by your actual repository name.</p>
<p>Now we are only left to fix the images, since they are being loaded from the <em>public</em> directory, our prefixes don't have any effect there. In order to fix that we will go to the files where we can create a <code>prefix.js</code> file and add the following:</p>
<pre><code>const prefix = process.env.NEXT_PUBLIC_BASE_PATH || '';

export { prefix };
</code></pre>
<p>Then we just need to import <code>prefix</code> where we are using references to the images and prepend that to the <code>src</code> attribute.</p>
<pre><code>...
import { prefix } from '../../utils/prefix.js';
...
    &#x3C;img src={`${prefix}/someimage.jpg`} alt='some alt text' />
...
</code></pre>
<p>Commit and push, and once the action is finished you will be able to see the images and navigate your app!</p>
<h2>Thanks!</h2>
<p>Thanks for reading this article! I hope this was helpful and as fun to read as it was to write!</p>
</div></article></main><div class="mb-5"><a href="/">← Back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"article":{"id":"deploy-nextjs-app-to-github-pages","contentHtml":"\u003cp\u003eThese last couple of days I've been wanting to create a simple and straight forward blog, to just keep the articles that I write and present myself. So I decided to do that using GitHub Pages and a simple NEXT.JS application, very similar to the one shown in the \u003ca href=\"https://nextjs.org/learn/basics/create-nextjs-app\"\u003eofficial tutorial\u003c/a\u003e. \u003cstrike\u003eIt suprised me how little and misleading information I found on how to do that, so I'm writing this.\u003c/strike\u003e While making this guide I found a video that explains a similar approach to what I did and it's worth taking a look at it! \u003ca href=\"https://www.youtube.com/watch?v=yRz8D_oJMWQ\"\u003eYou can check it out here\u003c/a\u003e. It would have save me some effort finding this earlier.\u003c/p\u003e\n\u003ch2\u003eConditions\u003c/h2\u003e\n\u003cp\u003eBefore we start, there are cases where this is not going to be possible so I want to save you the trouble of going through all of this just to get a disgusting suprise at the end.\u003c/p\u003e\n\u003cp\u003eWe are going to depend on the output of \u003ccode\u003enext export\u003c/code\u003e, so it is important that the application that you want to deploy is able to use it.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eWith \u003ccode\u003enext export\u003c/code\u003e, we build an HTML version of your app. At export time, we call \u003ccode\u003egetStaticProps\u003c/code\u003e for each page that exports it, and pass the result to the page's component. It's also possible to use the older \u003ccode\u003egetInitialProps\u003c/code\u003e API instead of \u003ccode\u003egetStaticProps\u003c/code\u003e, but it comes with a few caveats:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003egetInitialProps\u003c/code\u003e cannot be used alongside \u003ccode\u003egetStaticProps\u003c/code\u003e or \u003ccode\u003egetStaticPaths\u003c/code\u003e on any given page. If you have dynamic routes, instead of using \u003ccode\u003egetStaticPaths\u003c/code\u003e you'll need to configure the \u003ccode\u003eexportPathMap\u003c/code\u003e parameter in your \u003ccode\u003enext.config.js\u003c/code\u003e file to let the exporter know which HTML files it should output.\u003c/li\u003e\n\u003cli\u003eWhen \u003ccode\u003egetInitialProps\u003c/code\u003e is called during export, the \u003ccode\u003ereq\u003c/code\u003e and \u003ccode\u003eres\u003c/code\u003e fields of its \u003ccode\u003econtext\u003c/code\u003e parameter will be empty objects, since during export there is no server running.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003egetInitialProps\u003c/code\u003e \u003cstrong\u003ewill be called on every client-side navigation\u003c/strong\u003e, if you'd like to only fetch data at build-time, switch to \u003ccode\u003egetStaticProps\u003c/code\u003e.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003egetInitialProps\u003c/code\u003e should fetch from an API and cannot use Node.js-specific libraries or the file system like \u003ccode\u003egetStaticProps\u003c/code\u003e can.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eIt's recommended to use and migrate towards \u003ccode\u003egetStaticProps\u003c/code\u003e over \u003ccode\u003egetInitialProps\u003c/code\u003e whenever possible.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe \u003ccode\u003efallback: true\u003c/code\u003e mode of \u003ccode\u003egetStaticPaths\u003c/code\u003e is not supported when using \u003ccode\u003enext export\u003c/code\u003e.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eAPI Routes are not supported by this method because they can't be prerendered to HTML.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003egetServerSideProps\u003c/code\u003e cannot be used within pages because the method requires a server. Consider using \u003ccode\u003egetStaticProps\u003c/code\u003e instead.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eInternationalized Routing is not supported as it requires Next.js' server-side routing.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe \u003ccode\u003enext/image\u003c/code\u003e component's default loader is not supported when using \u003ccode\u003enext export\u003c/code\u003e. However, other loader options will work.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eYou can read \u003ca href=\"https://nextjs.org/docs/advanced-features/static-html-export\"\u003ehere\u003c/a\u003e for more information.\u003c/p\u003e\n\u003cp\u003eI will assume that you already have a NEXT.JS app. In order to test if your app will work, go to the \u003ccode\u003epackage.json\u003c/code\u003e and add an \u003ccode\u003eexport\u003c/code\u003e script to the \u003ccode\u003escripts\u003c/code\u003e section. It should look something like this:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e...\n\"scripts\": {\n    \"dev\": \"next dev\",\n    \"build\": \"next build\",\n    \"export\": \"next export\",\n    \"start\": \"next start\"\n},\n...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd now if you run \u003ccode\u003enpm run build \u0026#x26;\u0026#x26; npm run export\u003c/code\u003e without problems, then your app is ready.\u003c/p\u003e\n\u003ch2\u003eWhy?\u003c/h2\u003e\n\u003cp\u003eWhy would we try to do something like this if \u003cem\u003eVercel\u003c/em\u003e let's us publish the app without the need of using \u003ccode\u003enext export\u003c/code\u003e for free? If it's just a blog, why bother on doing all this to just deploy GitHub Pages? Well, in my case, it was because I wanted to accept \u003cem\u003eBrave Rewards\u003c/em\u003e and it turns out that that's against \u003cem\u003eVercel\u003c/em\u003e's fair use policy (I asked the \u003cem\u003eVercel\u003c/em\u003e team).\u003c/p\u003e\n\u003cp\u003eAnd I also like the idea of having my blog under \u003cem\u003e.github.io\u003c/em\u003e.\u003c/p\u003e\n\u003ch2\u003eGitHub Repository\u003c/h2\u003e\n\u003cp\u003eWe can use an existent repository for a project site or we can create one for our user or organization site. You can read \u003ca href=\"https://pages.github.com/\"\u003ehere\u003c/a\u003e for more information. The first one is a bit more complicated, but we will address the issues that might present later.\u003c/p\u003e\n\u003cp\u003eI will also assume that the source code for the NEXT.JS app is on the root (/) directory of the \u003ccode\u003emain\u003c/code\u003e branch. If that is not the case for you, you will have to make some changes to the things we do to follow along.\u003c/p\u003e\n\u003cp\u003eLet's create an orphan branch called \u003ccode\u003egh-pages\u003c/code\u003e on our local repository and make sure that the staging area is empty. Then create an empty commit and push the branch to GitHub.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003egit checkout --orphan gh-pages\ngit reset\ngit commit --allow-empty -m \"Initial commit\"\ngit push --set-upstream origin gh-pages\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow we go to the \u003cem\u003eSettings\u003c/em\u003e tab of our repository on GitHub, to the \u003cem\u003ePages\u003c/em\u003e section and select the branch \u003ccode\u003egh-pages\u003c/code\u003e and the \u003cem\u003e/ (root)\u003c/em\u003e directory, then we click \u003cem\u003eSave\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eWe could just push the result of the \u003ccode\u003eexport\u003c/code\u003e to \u003ccode\u003egh-pages\u003c/code\u003e manually every time we want to update the page. That will work, but it's too much work for every change we want to make and it requires a lot of manual intervention, so we also want this to be automated as much as possible.\u003c/p\u003e\n\u003ch2\u003eGitHub Actions\u003c/h2\u003e\n\u003cp\u003eLet's create a GitHub Action so every time we push our changes to \u003ccode\u003emain\u003c/code\u003e, we automatically deploy our app. You can read \u003ca href=\"https://docs.github.com/en/actions/reference/events-that-trigger-workflows\"\u003ehere\u003c/a\u003e if you want to use a different trigger.\u003c/p\u003e\n\u003cp\u003eWe will use the \u003cem\u003eNode.js\u003c/em\u003e template, you can find the updated one \u003ca href=\"https://docs.github.com/en/actions/guides/building-and-testing-nodejs\"\u003ehere\u003c/a\u003e. Create a file called \u003cem\u003egh-pages.deploy.yml\u003c/em\u003e (you can actually name it whatever you want) under the \u003cem\u003e.github/workflows\u003c/em\u003e directory.\u003c/p\u003e\n\u003cp\u003eIn that file we will modify the \u003cem\u003eNode.js\u003c/em\u003e template to suit our needs into something like this.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ename: Deploy to GitHub Pages\n\non:\n  push:\n    branches: [main]\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n\n    strategy:\n      matrix:\n        node-version: [14.x]\n\n    steps:\n      - name: Get files\n        uses: actions/checkout@v2\n      - name: Use Node.js ${{ matrix.node-version }}\n        uses: actions/setup-node@v2\n        with:\n          node-version: ${{ matrix.node-version }}\n      - name: Install packages\n        run: npm ci\n      - name: Build project\n        run: npm run build\n      - name: Export static files\n        run: npm run export\n      - name: Add .nojekyll file\n        run: touch ./out/.nojekyll\n      - name: Deploy\n        uses: JamesIves/github-pages-deploy-action@4.1.1\n        with:\n          branch: gh-pages\n          folder: out\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis file is a set of instructions for GitHub to run our tasks. Let's review it by parts.\u003c/p\u003e\n\u003cp\u003eThe first \u003ccode\u003ename\u003c/code\u003e is just to indicate the name of the workflow, you can change it to whatever you want.\u003c/p\u003e\n\u003cp\u003eThe \u003ccode\u003eon\u003c/code\u003e will specify when this workflow should be run. Here we are saying whenever we push to the main branch. You can modify this as needed by changing the branch name or even the trigger action, maybe you want this to be updated on PRs as well like it is on the template.\u003c/p\u003e\n\u003cp\u003eThen we have \u003ccode\u003ejobs\u003c/code\u003e. This section will define the jobs that we want to run on the workflow, here we have just the \u003ccode\u003ebuild\u003c/code\u003e. Inside it we also specify the OS in which it will be ran, the Node versions and the steps. Unless you really need to change the OS, leave it on \u003ccode\u003eubuntu-latest\u003c/code\u003e, you can read more about that \u003ca href=\"https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners\"\u003ehere\u003c/a\u003e. I selected only the 14.x version of Node because that is what works better for me, but if your project needs a different version, then you can change it.\u003c/p\u003e\n\u003cp\u003eThe steps that we will use are quiet simple. On the first step, the checkout step, we get our code. The second step will setup NodeJS. The third one will install the packages with \u003cem\u003enpm\u003c/em\u003e. The fourth one will build our project. The fifth will export the static files for \u003cem\u003eNEXT.JS\u003c/em\u003e. The sixth step will create a \u003cem\u003e.nojekyll\u003c/em\u003e file inside the directory with the exported files. The last step is extracted from \u003ca href=\"https://github.com/marketplace/actions/deploy-to-github-pages\"\u003ehere\u003c/a\u003e. It will create a branch, \u003ccode\u003egh-pages\u003c/code\u003e in our case, with the content of the \u003cem\u003eout\u003c/em\u003e directory. You can modify that if you need to. The \u003ccode\u003ename\u003c/code\u003e tag is optional, but I think it is nicer to look at than just the plain command.\u003c/p\u003e\n\u003cp\u003eIMPORTANT: keep the indentation of the YAML file, it relies on it (kind of like Python).\u003c/p\u003e\n\u003cp\u003eYou might be wondering what is the empty \u003cem\u003e.nojekyll\u003c/em\u003e file that we created. Well, GitHub Pages works with the Jekyll engine (more information \u003ca href=\"https://jekyllrb.com/docs/\"\u003ehere\u003c/a\u003e), so there are some directories that will be skipped automatically. Anything that starts with underscore or dot, won't be accessible. Since we need access to _\u003cem\u003enext\u003c/em\u003e directory, then we need to bypass Jekyll and the way to do that is by adding that \u003cem\u003e.nojekyll\u003c/em\u003e file.\u003c/p\u003e\n\u003cp\u003eNow we can push our content to the repository and if we check the \u003cem\u003eActions\u003c/em\u003e tab on GitHub, we will see that our workflow is running. Once it's finished, if we go to the GitHub Pages URL (it will be https://YOUR_USERNAME.github.io or https://YOUR_USERNAME.github.io/YOUR_REPOSITORY) we will see our page. If it's a user site, then that's it! We should be able to navigate everything correctly. If it's a project site you might be seeing some issues with the images and static resources. We will fix that next.\u003c/p\u003e\n\u003ch2\u003eFixing the issues\u003c/h2\u003e\n\u003cp\u003eFor project sites these are the problems we will see:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eImages are not loading\u003c/li\u003e\n\u003cli\u003eNavigation is not working\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eTo put it short, the reason why this is happening is because NEXT.JS expects to be under https://YOUR_USERNAME.github.io/ while we are under https://YOUR_USERNAME.github.io/YOUR_REPOSITORY. You can read more about this \u003ca href=\"https://nextjs.org/docs/basic-features/static-file-serving\"\u003ehere\u003c/a\u003e, \u003ca href=\"https://nextjs.org/docs/api-reference/next.config.js/cdn-support-with-asset-prefix\"\u003ehere\u003c/a\u003e and \u003ca href=\"https://nextjs.org/docs/api-reference/next.config.js/basepath\"\u003ehere\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eTo fix this we will make use of environment variables. On the example we can see on the NEXT.JS documentation, on the \u003cem\u003eCDN Supoport with Asset Prefix\u003c/em\u003e section, it's using the \u003cem\u003eNODE_ENV\u003c/em\u003e variable to check if we are on production. We could use something like that but in our case I prefer using the \u003cem\u003eNEXT_PUBLIC_BASE_PATH\u003c/em\u003e variable.\u003c/p\u003e\n\u003cp\u003eWe have to first create a file on the root of our app called \u003ccode\u003enext.config.js\u003c/code\u003e and put this content inside:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003emodule.exports {\n    basePath: process.env.NEXT_PUBLIC_BASE_PATH,\n    assetPrefix: process.env.NEXT_PUBLIC_BASE_PATH\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen on the YAML file (the one we named \u003ccode\u003egh-pages.deploy.yml\u003c/code\u003e earlier), we have to add that variable and initialize it with our repository name.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e...\njobs:\n  build:\n    runs-on: ubuntu-latest\n\n    env:\n      NEXT_PUBLIC_BASE_PATH: /YOUR_REPOSITORY\n\n    strategy:\n      matrix:\n        node-version: [14.x]\n...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eMake sure to replace \u003cem\u003eYOUR_REPOSITORY\u003c/em\u003e by your actual repository name.\u003c/p\u003e\n\u003cp\u003eNow we are only left to fix the images, since they are being loaded from the \u003cem\u003epublic\u003c/em\u003e directory, our prefixes don't have any effect there. In order to fix that we will go to the files where we can create a \u003ccode\u003eprefix.js\u003c/code\u003e file and add the following:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003econst prefix = process.env.NEXT_PUBLIC_BASE_PATH || '';\n\nexport { prefix };\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen we just need to import \u003ccode\u003eprefix\u003c/code\u003e where we are using references to the images and prepend that to the \u003ccode\u003esrc\u003c/code\u003e attribute.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e...\nimport { prefix } from '../../utils/prefix.js';\n...\n    \u0026#x3C;img src={`${prefix}/someimage.jpg`} alt='some alt text' /\u003e\n...\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCommit and push, and once the action is finished you will be able to see the images and navigate your app!\u003c/p\u003e\n\u003ch2\u003eThanks!\u003c/h2\u003e\n\u003cp\u003eThanks for reading this article! I hope this was helpful and as fun to read as it was to write!\u003c/p\u003e\n","title":"Deploy NEXT.JS App to GitHub Pages","date":"2021-04-29"}},"__N_SSG":true},"page":"/article/[id]","query":{"id":"deploy-nextjs-app-to-github-pages"},"buildId":"teUcAFLhczzehQgLjuP-D","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-8f31809deb7932dd0187.js"></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.4b81eedf2fcdb09bf521.js" async=""></script><script src="/_next/static/chunks/commons.4825e5e9d187cd4ab7dd.js" async=""></script><script src="/_next/static/chunks/main-86c34d104cdfe5877fdd.js" async=""></script><script src="/_next/static/chunks/pages/_app-c5dfe0a27de1f670d0d4.js" async=""></script><script src="/_next/static/chunks/63c1bd8fe8e29f7d1674476eb835b66f2691ac72.17a2de98099826b1f148.js" async=""></script><script src="/_next/static/chunks/pages/article/%5Bid%5D-a1e1aaf80fe42cc5b9f0.js" async=""></script><script src="/_next/static/teUcAFLhczzehQgLjuP-D/_buildManifest.js" async=""></script><script src="/_next/static/teUcAFLhczzehQgLjuP-D/_ssgManifest.js" async=""></script></body></html>